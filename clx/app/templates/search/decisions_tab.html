<main class="flex-1 min-h-0 overflow-y-auto pb-32 px-4 -mx-4" x-show="activeTab === 'decisions'" x-cloak>
    <div class="py-4">
        <div class="mb-8 rounded-xl border border-gray-200 bg-gradient-to-tl from-gray-200 to-gray-100 p-4 shadow-lg text-sm text-gray-700">
            <h3 class="text-base font-medium text-gray-900 mb-2">Decisions Overview</h3>
            <p class="mb-2">
                Decisions are a curated set of reason-annotated examples that establish what a label should apply to.
                We use decisions in the following ways:
            </p>
            <ul class="list-disc pl-5 space-y-1 mb-3">
                <li>
                    To guide the "predictor" model used to generate synthetic training data.
                    We use a DSPy optimizer to generate a prompt that for making predictions using an LLM.
                    The decision annotations are used as feedback to iteratively improve this prompt.
                </li>
                <li>
                    To select examples for the training set for finetuning models. For every decision annotated example,
                    treat it as a semantic anchor to pull in a sample of similar examples to ensure that the relevant language
                    is represented in the training set.
                </li>
            </ul>
            <p class="mb-2">
                Create a decision for any examples that the the predictor or finetune models tend to misclassify.
                You can also create decisions for ambiguous or tricky language where we want to establish a clear
                decision boundary for how we want to treat it in our ontology.
            </p>
        </div>
        <div class="mb-4 flex items-center justify-between">
            <h3 class="text-base font-medium text-gray-900" x-text="(labels?.[activeLabelId]?.name || '') + ' Decisions'"></h3>
            <div class="text-sm text-gray-500" x-text="decisions ? Object.keys(decisions || {}).length + ' total' : ''"></div>
        </div>
        <template x-if="!(decisions && Object.keys(decisions || {}).length)">
            <div class="text-sm text-gray-500">No decisions yet.</div>
        </template>
        <div class="flex flex-col gap-4">
            <template
                x-for="d in (Object.values(decisions || {}).slice().sort((a,b) => new Date(b?.updated_at) - new Date(a?.updated_at)))"
                :key="d.id"
            >
                <div
                    :id="'decision-' + d.text_hash"
                    class="bg-white border rounded-lg shadow-sm p-4"
                    x-data="{ editing: false, editValue: d.value, editReason: d.reason }"
                    @click.outside="editing = false"
                >
                    <div class="flex items-start justify-between gap-3">
                        <div class="flex items-center gap-2 flex-wrap">
                            <span
                                class="inline-flex items-center rounded-full px-2 py-0.5 text-xs"
                                :class="d.value ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
                                x-text="d.value ? 'Positive' : 'Negative'"
                            ></span>
                        </div>
                        <div class="flex items-center gap-2" x-data="{ open: false }">
                            <button
                                type="button"
                                class="rounded-md px-2 py-0.5 text-xs bg-gray-100 text-gray-700 hover:bg-gray-200"
                                @click="editing = !editing; editValue = d.value; editReason = d.reason"
                            >
                                <span x-text="editing ? 'Cancel' : 'Edit'"></span>
                            </button>
                            <template x-if="!open">
                                <button
                                    type="button"
                                    class="rounded-md px-2 py-0.5 text-xs bg-gray-100 text-gray-700 hover:bg-gray-200"
                                    @click="open = true"
                                >Delete</button>
                            </template>
                            <template x-if="open">
                                <div class="flex items-center gap-2" @click.outside="open = false">
                                    <span class="text-xs text-gray-700">Are you sure?</span>
                                    <button
                                        type="button"
                                        class="rounded-md px-2 py-0.5 text-xs bg-red-500 text-white hover:bg-red-600"
                                        @click="deleteDecision(d.id)"
                                    >Yes</button>
                                    <button
                                        type="button"
                                        class="rounded-md px-2 py-0.5 text-xs bg-gray-100 text-gray-700 hover:bg-gray-200"
                                        @click="open = false"
                                    >No</button>
                                </div>
                            </template>
                        </div>
                    </div>
                    <div class="prose prose-sm max-w-none mt-2">
                        <p class="text-gray-800" x-text="d.text || ''"></p>
                    </div>
                    <div class="mt-3 rounded-md border border-gray-200 bg-gray-50 p-3" x-show="!editing">
                        <div class="text-sm text-gray-800 whitespace-pre-wrap break-words" x-text="d.reason"></div>
                    </div>
                    <div class="mt-3" x-show="editing" x-cloak>
                        <textarea class="w-full rounded-md ring-1 ring-gray-300 focus:ring-blue-500 text-sm p-2" rows="3" x-model="editReason" placeholder="Enter reasonâ€¦"></textarea>
                    </div>
                    <div class="mt-3 flex items-center justify-between" x-show="editing" x-cloak>
                        <div class="flex items-center gap-2">
                            <button
                                type="button"
                                class="rounded-md px-2 py-0.5 text-xs"
                                :class="editValue ? 'bg-green-500 text-white hover:bg-green-600' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                @click="editValue = true"
                            >Positive</button>
                            <button
                                type="button"
                                class="rounded-md px-2 py-0.5 text-xs"
                                :class="!editValue ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                @click="editValue = false"
                            >Negative</button>
                        </div>
                        <div class="flex items-center gap-2">
                            <button
                                type="button"
                                class="inline-flex items-center justify-center rounded-md bg-blue-600 px-2 py-1 text-white text-xs hover:bg-blue-700"
                                @click="await updateDecision(d.label_id, d.text_hash, editValue, editReason); editing = false;"
                            >Save</button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
</main>