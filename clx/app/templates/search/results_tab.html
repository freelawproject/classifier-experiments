<main class="flex-1 min-h-0 overflow-y-auto pb-32 px-4 -mx-4" x-ref="resultsContainer" x-show="activeTab === 'search'" x-cloak>
    <div class="flex flex-col gap-4 py-4">
        <template x-for="(result, idx) in (results?.data || [])" :key="idx">
            <div class="bg-white border rounded-lg shadow-sm p-4" x-data="{ showAddDecision: false, addReason: '', addValue: true }">
                <div class="flex items-start justify-between mb-2">
                    <div class="flex items-center gap-2">
                        <button
                            type="button"
                            class="text-sm text-gray-500 hover:text-gray-700"
                            @click="semantic_sort = result.text; search()"
                        ><i class="fa-solid fa-circle-nodes"></i></button>
                        <div class="text-sm text-gray-500" x-text="result.id"></div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button
                            type="button"
                            class="rounded-md px-2 py-0.5 text-xs bg-gray-100 text-gray-700 hover:bg-gray-200"
                            x-show="!decisionForTextHash(result.text_hash);"
                            @click="showAddDecision = true"
                        >Decision</button>
                        <button
                            type="button"
                            class="rounded-md px-2 py-0.5 text-xs bg-gray-900 text-white hover:bg-gray-800"
                            x-show="decisionForTextHash(result.text_hash);"
                            @click="goToDecisionByHash(result.text_hash)"
                        >Decision</button>
                        <div
                            x-data="{ annotating: false }"
                            class="inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-1 text-sm"
                        >
                            <button
                                type="button"
                                class="rounded-full disabled:opacity-50"
                                :disabled="annotating || !activeLabelId"
                                @click="annotating=true; await annotate(result.id, 'true', result); annotating=false;"
                            >
                                <i class="fa-circle-check"
                                    :class="exampleActiveAnnotation(result) === 'true' ? 'fa-solid text-green-600' : 'fa-regular text-gray-500 hover:text-gray-700'"
                                ></i>
                            </button>
                            <button
                                type="button"
                                class="rounded-full disabled:opacity-50"
                                :disabled="annotating || !activeLabelId"
                                @click="annotating=true; await annotate(result.id, 'false', result); annotating=false;"
                            >
                                <i class="fa-circle-xmark"
                                    :class="exampleActiveAnnotation(result) === 'false' ? 'fa-solid text-red-600' : 'fa-regular text-gray-500 hover:text-gray-700'"
                                ></i>
                            </button>
                            <button
                                type="button"
                                class="rounded-full disabled:opacity-50"
                                :disabled="annotating || !activeLabelId"
                                @click="annotating=true; await annotate(result.id, 'flag', result); annotating=false;"
                            >
                                <i
                                    class="fa-circle-right"
                                    :class="exampleActiveAnnotation(result) === 'flag' ? 'fa-solid text-amber-600' : 'fa-regular text-gray-500 hover:text-gray-700'"
                                ></i>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Add decision form -->
                <div class="my-3" x-show="showAddDecision" @click.outside="showAddDecision = false" x-cloak>
                    <div class="grid grid-cols-1 md:grid-cols-[1fr_12rem] gap-3 items-stretch">
                        <textarea
                            class="w-full rounded-md bg-white ring-1 ring-gray-300 focus:ring-blue-500 text-sm p-2"
                            rows="2"
                            x-model="addReason"
                            placeholder="Enter reasonâ€¦"
                        ></textarea>
                        <div class="flex flex-col gap-2 justify-between">
                            <div class="flex items-center gap-2">
                                <button
                                    type="button"
                                    class="rounded-md w-full px-2 py-0.5 text-xs"
                                    :class="addValue ? 'bg-green-500 text-white hover:bg-green-600' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                    @click="addValue = true"
                                >Positive</button>
                                <button
                                    type="button"
                                    class="rounded-md w-full px-2 py-0.5 text-xs"
                                    :class="!addValue ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                    @click="addValue = false"
                                >Negative</button>
                            </div>
                            <div class="flex w-full">
                                <button
                                    type="button"
                                    class="inline-flex w-full items-center justify-center rounded-md bg-blue-600 px-2 py-1 text-white text-xs hover:bg-blue-700 disabled:opacity-50"
                                    :disabled="!activeLabelId || !(addReason && addReason.trim())"
                                    @click="showAddDecision = false; await updateDecision(activeLabelId, result.text_hash, addValue, addReason); addReason = ''; addValue = true;"
                                >
                                    Submit Decision
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="prose prose-sm max-w-none mb-3">
                    <p x-text="result.text"></p>
                </div>
                <template x-if="result.split">
                    <div class="my-3 rounded-md border border-gray-200 bg-gray-50 p-3">
                        <div class="flex items-center justify-between mb-1 text-xs font-medium">
                            <div class="flex items-center gap-3">
                                <div x-show="result.pred">
                                    <i class="fa-regular fa-circle-check text-green-600 me-1"></i> Predicted True
                                </div>
                                <div x-show="!result.pred">
                                    <i class="fa-regular fa-circle-xmark text-red-600 me-1"></i> Predicted False
                                </div>
                                <template x-for="ft in (Object.values(finetunes || {}))" :key="ft.id">
                                    <span
                                        class="inline-flex items-center rounded-full px-2 py-0.5 ring-1 ring-inset"
                                        :class="((() => { const tagId = (getTagsByPrefix('trainset:ft:' + (ft?.config_name || ''), true).map(t => t.id).find(id => id !== null)); return tagId && (result.tags || []).includes(tagId); })()) ? 'ring-green-600 text-green-600' : 'ring-red-600 text-red-600'"
                                    >
                                        <i
                                            :class="((() => { const tagId = (getTagsByPrefix('trainset:ft:' + (ft?.config_name || ''), true).map(t => t.id).find(id => id !== null)); return tagId && (result.tags || []).includes(tagId); })()) ? 'fa-regular fa-circle-check me-1' : 'fa-regular fa-circle-xmark me-1'"
                                        ></i>
                                        <span x-text="'FT: ' + (ft?.config_name || '')"></span>
                                    </span>
                                </template>
                            </div>
                            <div class="text-gray-500">
                                Trainset: <span x-text="result.split.toLocaleUpperCase()"></span>
                            </div>
                        </div>
                        <div class="text-sm text-gray-800 whitespace-pre-wrap break-words" x-text="result.reason"></div>
                    </div>
                </template>
                <div class="flex flex-wrap gap-2">
                    <template x-for="tag_id in (result.tags || []).filter(tid => (displayTags || []).includes(tid))" :key="tag_id">
                        <span
                            class="inline-flex items-center rounded-full bg-blue-100 px-2 py-1 text-xs text-gray-700"
                            x-text="tags?.[tag_id]?.slug"
                            x-show="tags?.[tag_id]?.slug"
                        ></span>
                    </template>
                </div>
                <div class="flex flex-wrap gap-2">
                    <template x-for="tag_id in (result.tags || []).filter(tid => tid.startsWith('ft:'))" :key="tag_id">
                        <span
                            class="inline-flex items-center rounded-full bg-red-100 px-2 py-1 text-xs text-gray-700"
                            x-text="labels?.[tags?.[tag_id]?.label_id]?.name"
                            x-show="labels?.[tags?.[tag_id]?.label_id]?.name"
                        ></span>
                    </template>
                </div>
            </div>
        </template>
    </div>
    <!-- Pagination footer -->
    <div class="mt-4 border-t border-gray-200 pt-3">
        <div class="flex items-center justify-between">
            <div class="text-sm text-gray-600">
                Page <span x-text="page"></span>
            </div>
            <div class="flex items-center gap-2">
                <button
                    type="button"
                    class="rounded-md px-3 py-1.5 text-sm bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50"
                    :disabled="loading || page <= 1"
                    @click="await search({ page: Math.max(1, page - 1) })"
                    title="Previous page"
                >
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <button
                    type="button"
                    class="rounded-md px-3 py-1.5 text-sm bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50"
                    :disabled="loading"
                    @click="await search({ page: page + 1 })"
                    title="Next page"
                >
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</main>